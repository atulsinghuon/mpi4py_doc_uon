<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MPI4Py on ADA &mdash; MPI4Py on ADA 1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=f2a433a1"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Hello world" href="01hello.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            MPI4Py on ADA
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="01hello.html">Hello world</a></li>
<li class="toctree-l1"><a class="reference internal" href="02p2p.html">Point to point communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="03broadcast.html">Broadcast</a></li>
<li class="toctree-l1"><a class="reference internal" href="04scatter.html">Scatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="05gather.html">Gather</a></li>
<li class="toctree-l1"><a class="reference internal" href="06barrier.html">Barrier</a></li>
<li class="toctree-l1"><a class="reference internal" href="07picalc.html">Example: Calculation of pi</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">MPI4Py on ADA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">MPI4Py on ADA</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mpi4py-on-ada">
<h1>MPI4Py on ADA<a class="headerlink" href="#mpi4py-on-ada" title="Link to this heading"></a></h1>
<p>MPI4Py is a python package that uses Message Passing Interface (MPI). MPI is used for multi-node communication for parallel calculations in HPC.</p>
<p>Using SLURM to ask for more resources does not automatically gaurantee parallel features, as the data still needs to passed between processors, for which MPI is essential.</p>
<section id="why-use-mpi">
<h2>Why use MPI?<a class="headerlink" href="#why-use-mpi" title="Link to this heading"></a></h2>
<figure class="align-default">
<img alt="_images/mpioverview.png" src="_images/mpioverview.png" />
</figure>
<p>Image reference from Rolf Rabenseifner’s course on MPI.</p>
<p>A sequential approach to programming involves data from memory being transferred to a process in a processor.
While an MPI approach as shown in figure above, can do the same, but in parallel, by “distributing” the memory to parallel processes for various computations.</p>
</section>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading"></a></h2>
<p>The following set of commands set up the conda environment required to run MPI using the MPI4Py package on ADA.
On the login node on ADA, the following steps create an mpi4py environment which will be used to submit jobs on the compute nodes.</p>
<ol class="arabic">
<li><p>Load Anaconda</p>
<p><code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">anaconda-uoneasy/x.x</span></code></p>
</li>
<li><p>Load gcc as this is required to compile the files.</p>
<p><code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">load</span> <span class="pre">gcc</span></code></p>
</li>
<li><p>Create a new conda environment.</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">create</span> <span class="pre">--name</span> <span class="pre">mpi4pytest</span></code></p>
<p>Note that this environment will be created with the default version of python from the available modules. This can be checked with <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">--version</span></code>. If a different python version is desired <code class="docutils literal notranslate"><span class="pre">--python=3.X.X</span></code> by replacing X with the specific version number. This flag can then be added after <code class="docutils literal notranslate"><span class="pre">mpi4pytest</span></code> above. For examples</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">create</span> <span class="pre">--name</span> <span class="pre">mpi4pytest</span> <span class="pre">--python=3.11.2</span></code></p>
</li>
<li><p>Activate the created environment.</p>
<p><code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">activate</span> <span class="pre">mpi4pytest</span></code></p>
</li>
<li><p>Install the mpi4py library to the conda environment.</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-c</span> <span class="pre">conda-forge</span> <span class="pre">mpi4py</span> <span class="pre">mpich</span></code></p>
</li>
<li><p>Install any other libraries that you may need with your mpi4py work.</p>
<p><code class="docutils literal notranslate"><span class="pre">Conda</span> <span class="pre">install</span> <span class="pre">numpy</span></code></p>
</li>
<li><p>A sanity check can be performed to see if the MPI4Py installation has been successful.</p>
<p><code class="docutils literal notranslate"><span class="pre">mpiexec</span> <span class="pre">-n</span> <span class="pre">12</span> <span class="pre">python</span> <span class="pre">-m</span> <span class="pre">mpi4py.bench</span> <span class="pre">helloworld</span></code></p>
</li>
</ol>
<p>This should give you the following result, indicating 12 threads were used.</p>
<p>All the above has been indicated below together.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Creating a conda environment to run MPI4Py on Ada.</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">mpi4pytest</span> <span class="o">--</span><span class="n">python</span><span class="o">=</span><span class="mf">3.11.2</span>
<span class="n">source</span> <span class="n">activate</span> <span class="n">mpi4pytest</span>
<span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">mpi4py</span> <span class="n">mpich</span> <span class="o">-</span><span class="n">y</span>
<span class="n">conda</span> <span class="n">install</span> <span class="n">numpy</span> <span class="o">-</span><span class="n">y</span>
<span class="n">mpiexec</span> <span class="o">-</span><span class="n">n</span> <span class="mi">12</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">mpi4py</span><span class="o">.</span><span class="n">bench</span> <span class="n">helloworld</span>
</pre></div>
</div>
</div>
</section>
<section id="chapters">
<h2>Chapters<a class="headerlink" href="#chapters" title="Link to this heading"></a></h2>
<p>The following examples are discussed in this documentation. These examples can be copied to your <code class="docutils literal notranslate"><span class="pre">\home</span></code> directory using the command <code class="docutils literal notranslate"><span class="pre">copy_mpi4py_examples</span></code>.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="01hello.html">Hello world</a></li>
<li class="toctree-l1"><a class="reference internal" href="02p2p.html">Point to point communication</a><ul>
<li class="toctree-l2"><a class="reference internal" href="02p2p.html#comm.send"><code class="docutils literal notranslate"><span class="pre">comm.send()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="02p2p.html#comm.recv"><code class="docutils literal notranslate"><span class="pre">comm.recv()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03broadcast.html">Broadcast</a><ul>
<li class="toctree-l2"><a class="reference internal" href="03broadcast.html#comm.bcast"><code class="docutils literal notranslate"><span class="pre">comm.bcast()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="04scatter.html">Scatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="05gather.html">Gather</a></li>
<li class="toctree-l1"><a class="reference internal" href="06barrier.html">Barrier</a></li>
<li class="toctree-l1"><a class="reference internal" href="07picalc.html">Example: Calculation of pi</a></li>
</ul>
</div>
</section>
<section id="submitting-a-job-to-ada">
<h2>Submitting a job to ADA<a class="headerlink" href="#submitting-a-job-to-ada" title="Link to this heading"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#SBATCH --partition = defq</span>
<span class="c1">#SBATCH --nodes = 1</span>
<span class="c1">#SBATCH --ntasks-per-node = 12</span>
<span class="c1">#SBATCH --mem=2g ##Change this if job requires higher memory.</span>
<span class="c1">#SBATCH --time = 1:00:00</span>


moudle<span class="w"> </span>load<span class="w"> </span>anaconda-uoneasy/
module<span class="w"> </span>load<span class="w"> </span>openmpi/gcc/4.1.6

<span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>mpi4pytest<span class="w"> </span><span class="c1">## this conda environment name should the same as what was created.</span>

mpirun<span class="w"> </span>-np<span class="w"> </span><span class="nv">$SLURM_NTASKS</span><span class="w"> </span>python<span class="w"> </span>&lt;pyfilename.py&gt;
</pre></div>
</div>
<p>The above will run the code on the value assigned to <code class="docutils literal notranslate"><span class="pre">--ntasks-per-node</span></code> number of processors.</p>
<p>Save the above file (say run.slurm) and type the following command in from the same directory where you have the python file pyfilename.py.</p>
<p><code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">run.slurm</span></code></p>
<p>The submitted job can be tracked with</p>
<p><code class="docutils literal notranslate"><span class="pre">squeue</span> <span class="pre">-lu</span> <span class="pre">&lt;user_id&gt;</span></code></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>An elaborate deep dive for MPI4py is available <a class="reference external" href="https://fs.hlrs.de/projects/par/par_prog_ws/pdf/mpi_3.1_rab-animated.pdf">here</a>. This documentation however, gives basic examples for MPI concepts on ADA, but is also heavily inspired from the course above.</p>
</div>
<div class="toctree-wrapper compound">
</div>
</section>
<section id="indices-and-tables">
<h2>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01hello.html" class="btn btn-neutral float-right" title="Hello world" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Atul Singh.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>